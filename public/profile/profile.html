<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Perfil - UPSEN Accounting</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    * { box-sizing: border-box; }
    body { font-family: 'Segoe UI', Arial, sans-serif; background-color: #eef1f7; min-height: 100vh; }
    .sidebar { width: 260px; background: linear-gradient(180deg, #2c3e50 0%, #1a252f 100%); color: white; min-height: 100vh; position: fixed; box-shadow: 4px 0 20px rgba(0,0,0,0.15); }
    .sidebar-header { padding: 30px 20px; font-size: 1.6em; font-weight: bold; background: rgba(0,0,0,0.2); text-align: center; border-bottom: 1px solid rgba(255,255,255,0.1); display: flex; align-items: center; justify-content: center; gap: 10px; }
    .sidebar-header i { color: #1abc9c; }
    .sidebar-menu { list-style: none; padding: 0; margin: 0; }
    .sidebar-menu li { padding: 0; transition: all 0.3s; border-left: 4px solid transparent; }
    .sidebar-menu li:hover { background: rgba(26, 188, 156, 0.15); border-left-color: #1abc9c; }
    .sidebar-menu li.active { background: rgba(26, 188, 156, 0.2); border-left-color: #1abc9c; }
    .sidebar-link { color: inherit; text-decoration: none; display: flex; align-items: center; gap: 12px; padding: 15px 20px; transition: all 0.3s; }
    .sidebar-link:hover { color: #1abc9c; }
    .sidebar-link i { width: 24px; text-align: center; color: rgba(255,255,255,0.7); transition: color 0.3s; }
    .main-content { margin-left: 260px; padding: 30px; min-height: 100vh; }
    .page-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; flex-wrap: wrap; gap: 15px; }
    .page-title { font-size: 2em; font-weight: 700; color: #2c3e50; display: flex; align-items: center; gap: 15px; }
    .page-title i { color: #1abc9c; }
    .modern-card { background: white; border-radius: 16px; padding: 25px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); margin-bottom: 25px; transition: all 0.3s; border: 1px solid rgba(0,0,0,0.05); }
    .modern-card:hover { transform: translateY(-3px); box-shadow: 0 8px 30px rgba(0,0,0,0.12); }
    .user-avatar { width: 100px; height: 100px; border-radius: 50%; background: linear-gradient(135deg, #2a4d9c 0%, #3a6cd6 100%); color: white; display: flex; align-items: center; justify-content: center; font-size: 2.5em; margin: 0 auto 20px; box-shadow: 0 6px 20px rgba(42, 77, 156, 0.3); }
    .user-name { text-align: center; font-size: 1.5em; font-weight: 700; color: #2c3e50; margin-bottom: 5px; }
    .user-email { text-align: center; color: #6c757d; font-size: 1em; margin-bottom: 15px; }
    .user-role { display: inline-block; padding: 6px 16px; background: linear-gradient(135deg, #1abc9c, #16a085); color: white; border-radius: 20px; font-size: 0.9em; font-weight: 500; }
    .section-title { color: #2a4d9c; font-weight: 600; margin-bottom: 20px; display: flex; align-items: center; gap: 10px; }
    .section-title i { color: #1abc9c; }
    .info-label { color: #6c757d; font-size: 0.9em; margin-bottom: 5px; }
    .info-value { font-weight: 600; color: #2c3e50; font-size: 1em; }
    .form-control, .form-select { border-radius: 10px; padding: 12px 15px; border: 2px solid #e9ecef; transition: all 0.3s; }
    .form-control:focus, .form-select:focus { border-color: #2a4d9c; box-shadow: 0 0 0 4px rgba(42, 77, 156, 0.1); }
    .btn { border-radius: 10px; padding: 12px 25px; font-weight: 500; transition: all 0.3s; border: none; }
    .btn-primary { background: linear-gradient(135deg, #2a4d9c, #3a6cd6); color: white; }
    .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 5px 20px rgba(42, 77, 156, 0.4); color: white; }
    .btn-success { background: linear-gradient(135deg, #1abc9c, #16a085); color: white; }
    .btn-success:hover { transform: translateY(-2px); box-shadow: 0 5px 20px rgba(26, 188, 156, 0.4); color: white; }
    .btn-danger { background: linear-gradient(135deg, #e74c3c, #c0392b); color: white; }
    .btn-danger:hover { transform: translateY(-2px); box-shadow: 0 5px 20px rgba(231, 76, 60, 0.4); color: white; }
    .btn-secondary { background: #e9ecef; border: none; color: #495057; }
    .btn-secondary:hover { background: #dee2e6; transform: translateY(-2px); }
    .btn-info { background: #17a2b8; border: none; color: white; }
    .stat-card { background: #f8f9fa; border-radius: 12px; padding: 20px; text-align: center; border: 1px solid #e9ecef; transition: all 0.3s; }
    .stat-card:hover { transform: translateY(-3px); box-shadow: 0 5px 20px rgba(0,0,0,0.1); }
    .stat-icon { width: 50px; height: 50px; border-radius: 12px; display: flex; align-items: center; justify-content: center; margin: 0 auto 12px; font-size: 1.3em; }
    .stat-icon.blue { background: rgba(42, 77, 156, 0.15); color: #2a4d9c; }
    .stat-icon.green { background: rgba(26, 188, 156, 0.15); color: #1abc9c; }
    .stat-icon.red { background: rgba(231, 76, 60, 0.15); color: #e74c3c; }
    .stat-icon.purple { background: rgba(155, 89, 182, 0.15); color: #9b59b6; }
    .stat-value { font-size: 1.8em; font-weight: 700; color: #2c3e50; margin: 0; }
    .stat-label { color: #6c757d; font-size: 0.85em; margin-top: 5px; }
    .alert { border-radius: 10px; padding: 15px 20px; margin-bottom: 20px; display: flex; align-items: center; gap: 10px; }
    .alert-success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
    .alert-error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    .modal-content { border-radius: 16px; overflow: hidden; border: none; box-shadow: 0 15px 50px rgba(0,0,0,0.2); }
    .modal-header { background: linear-gradient(135deg, #2a4d9c, #3a6cd6); color: white; border: none; padding: 20px 25px; }
    .modal-header .btn-close { filter: brightness(0) invert(1); }
    .modal-body { padding: 25px; background: #f6f8fc; }
    .modal-footer { padding: 20px 25px; border-top: 1px solid #e9ecef; background: #f6f8fc; }
    #loadingOverlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(255,255,255,0.95); display: flex; align-items: center; justify-content: center; z-index: 9999; }
    .spinner { width: 45px; height: 45px; border: 4px solid #e9ecef; border-top-color: #2a4d9c; border-radius: 50%; animation: spin 0.8s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }
    .hidden { display: none !important; }
    @media (max-width: 992px) { .sidebar { position: relative; width: 100%; min-height: auto; } .main-content { margin-left: 0; } }
  </style>
</head>
<body>
<div class="container-fluid p-0">
  <div class="row m-0">
    <aside class="sidebar">
      <div class="sidebar-header"><i class="fas fa-chart-line"></i>Accounting</div>
      <ul class="sidebar-menu">
        <li><a href="../frontPage/frontPage.html" class="sidebar-link"><i class="fas fa-tachometer-alt"></i> Panel</a></li>
        <li><a href="../expense/expense.html" class="sidebar-link"><i class="fas fa-file-invoice-dollar"></i> Gastos</a></li>
        <li><a href="../Invoice-issued/invoice-issued.html" class="sidebar-link"><i class="fas fa-file-export"></i> Facturas emitidas</a></li>
        <li><a href="../Invoice_recieved/Invoice_recieved.html" class="sidebar-link"><i class="fas fa-file-import"></i> Facturas recibidas</a></li>
        <li><a href="../budgetPage/budget.html" class="sidebar-link"><i class="fas fa-calculator"></i> Presupuestos</a></li>
        <li class="active"><a href="profile.html" class="sidebar-link"><i class="fas fa-user"></i> Perfil</a></li>
        <li><a href="settings.html" class="sidebar-link"><i class="fas fa-cog"></i> Configuracion</a></li>
      </ul>
    </aside>
    <main class="main-content col">
      <div class="page-header">
        <h1 class="page-title"><i class="fas fa-user"></i> Mi Perfil</h1>
        <button class="btn btn-primary" onclick="showEditModal()"><i class="fas fa-edit me-2"></i>Editar Perfil</button>
      </div>
      <div id="alertMessage" class="alert hidden"></div>
      <div class="modern-card">
        <div class="user-avatar" id="userAvatar">U</div>
        <div class="user-name" id="userName">Usuario</div>
        <div class="user-email" id="userEmail">-</div>
        <span class="user-role" id="userRole">Usuario</span>
      </div>
      <div class="row">
        <div class="col-lg-6 mb-4">
          <div class="modern-card">
            <h5 class="section-title"><i class="fas fa-building"></i> Datos de la Empresa</h5>
            <div class="row">
              <div class="col-6 mb-3"><div class="info-label">Nombre</div><div class="info-value" id="displayCompanyName">-</div></div>
              <div class="col-6 mb-3"><div class="info-label">Telefono</div><div class="info-value" id="displayPhone">-</div></div>
              <div class="col-6 mb-3"><div class="info-label">Email</div><div class="info-value" id="displayEmail">-</div></div>
              <div class="col-6 mb-3"><div class="info-label">Rol</div><div class="info-value" id="displayRole">-</div></div>
            </div>
          </div>
        </div>
        <div class="col-lg-6 mb-4">
          <div class="modern-card">
            <h5 class="section-title"><i class="fas fa-sliders-h"></i> Preferencias</h5>
            <div class="row">
              <div class="col-4 mb-3"><div class="info-label">Moneda</div><div class="info-value" id="displayCurrency">-</div></div>
              <div class="col-4 mb-3"><div class="info-label">Idioma</div><div class="info-value" id="displayLanguage">-</div></div>
              <div class="col-4 mb-3"><div class="info-label">Tema</div><div class="info-value" id="displayTheme">-</div></div>
            </div>
          </div>
        </div>
      </div>
      <div class="modern-card">
        <h5 class="section-title"><i class="fas fa-chart-bar"></i> Estadisticas</h5>
        <div class="row">
          <div class="col-md-3 col-6 mb-3">
            <div class="stat-card">
              <div class="stat-icon blue"><i class="fas fa-file-invoice"></i></div>
              <div class="stat-value" id="statInvoices">0</div>
              <div class="stat-label">Facturas Recibidas</div>
            </div>
          </div>
          <div class="col-md-3 col-6 mb-3">
            <div class="stat-card">
              <div class="stat-icon green"><i class="fas fa-file-export"></i></div>
              <div class="stat-value" id="statIssued">0</div>
              <div class="stat-label">Facturas Emitidas</div>
            </div>
          </div>
          <div class="col-md-3 col-6 mb-3">
            <div class="stat-card">
              <div class="stat-icon red"><i class="fas fa-shopping-cart"></i></div>
              <div class="stat-value" id="statExpenses">0</div>
              <div class="stat-label">Gastos</div>
            </div>
          </div>
          <div class="col-md-3 col-6 mb-3">
            <div class="stat-card">
              <div class="stat-icon purple"><i class="fas fa-calculator"></i></div>
              <div class="stat-value" id="statBudgets">0</div>
              <div class="stat-label">Presupuestos</div>
            </div>
          </div>
        </div>
      </div>
      <div class="modern-card">
        <h5 class="section-title"><i class="fas fa-info-circle"></i> Informacion</h5>
        <div class="row">
          <div class="col-md-6 mb-3"><div class="info-label">Fecha de registro</div><div class="info-value" id="displayCreatedAt">-</div></div>
          <div class="col-md-6 mb-3"><div class="info-label">Ultimo acceso</div><div class="info-value" id="displayLastLogin">-</div></div>
        </div>
      </div>
      <div class="modern-card">
        <h5 class="section-title"><i class="fas fa-cogs"></i> Acciones</h5>
        <div class="d-flex flex-wrap gap-3">
          <button class="btn btn-primary" onclick="showEditModal()"><i class="fas fa-edit me-2"></i>Editar</button>
          <button class="btn btn-success" onclick="showPasswordModal()"><i class="fas fa-lock me-2"></i>Password</button>
          <button class="btn btn-info" onclick="exportDataPDF()"><i class="fas fa-file-pdf me-2"></i>PDF</button>
          <button class="btn btn-danger" onclick="deleteAccount()"><i class="fas fa-trash me-2"></i>Eliminar</button>
          <button class="btn btn-warning" onclick="logout()" style="background: #f39c12; border: none; color: white;"><i class="fas fa-sign-out-alt me-2"></i>Cerrar sesion</button>
        </div>
      </div>
    </main>
  </div>
</div>
<div class="modal fade" id="editProfileModal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title"><i class="fas fa-user-edit me-2"></i>Editar Perfil</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div id="editAlert" class="alert hidden"></div>
        <div class="row">
          <div class="col-md-6 mb-3"><label class="form-label">Nombre</label><input type="text" class="form-control" id="editName" placeholder="Tu nombre"></div>
          <div class="col-md-6 mb-3"><label class="form-label">Empresa</label><input type="text" class="form-control" id="editCompany" placeholder="Empresa"></div>
          <div class="col-md-6 mb-3"><label class="form-label">Telefono</label><input type="tel" class="form-control" id="editPhone" placeholder="Telefono"></div>
          <div class="col-md-6 mb-3"><label class="form-label">Email</label><input type="email" class="form-control" id="editEmail" readonly></div>
        </div>
        <hr><h6 class="mb-3">Preferencias</h6>
        <div class="row">
          <div class="col-md-4 mb-3"><label class="form-label">Moneda</label>
            <select class="form-select" id="editCurrency"><option value="EUR">Euro (EUR)</option><option value="USD">Dolar (USD)</option><option value="GBP">Libra (GBP)</option><option value="BRL">Real (BRL)</option></select>
          </div>
          <div class="col-md-4 mb-3"><label class="form-label">Idioma</label>
            <select class="form-select" id="editLanguage"><option value="es">Espanol</option><option value="pt">Portugues</option><option value="en">English</option></select>
          </div>
          <div class="col-md-4 mb-3"><label class="form-label">Tema</label>
            <select class="form-select" id="editTheme"><option value="light">Claro</option><option value="dark">Oscuro</option></select>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
        <button type="button" class="btn btn-primary" onclick="saveProfile()"><i class="fas fa-save me-2"></i>Guardar</button>
      </div>
    </div>
  </div>
</div>
<div class="modal fade" id="passwordModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title"><i class="fas fa-lock me-2"></i>Cambiar Contrasena</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div id="passwordAlert" class="alert hidden"></div>
        <div class="mb-3"><label class="form-label">Nueva contrasena</label><input type="password" class="form-control" id="newPassword" placeholder="Minimo 6 caracteres"></div>
        <div class="mb-3"><label class="form-label">Confirmar contrasena</label><input type="password" class="form-control" id="confirmPassword" placeholder="Repetir contrasena"></div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
        <button type="button" class="btn btn-success" onclick="changePassword()"><i class="fas fa-key me-2"></i>Cambiar</button>
      </div>
    </div>
  </div>
</div>
<div id="loadingOverlay"><div class="spinner"></div></div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="../shared/auth-system.js"></script>
<script>
var editModal = null;
var passwordModal = null;
function hideLoading() { var o = document.getElementById('loadingOverlay'); if (o) o.style.display = 'none'; }
function getUserId() { try { var s = localStorage.getItem('upsen_current_user'); if (s) { var d = JSON.parse(s); if (d && d.user) return d.user.uid || d.user.id || 'demo'; } } catch (e) {} return 'demo'; }
function getUserData(k) { try { var d = localStorage.getItem(k); if (d) return JSON.parse(d); } catch (e) {} return []; }
function setText(id, v) { var e = document.getElementById(id); if (e) e.textContent = v; }
function formatDate(ds) { if (!ds) return '-'; var d = new Date(ds); return d.toLocaleDateString('es-ES', {day:'2-digit',month:'2-digit',year:'numeric',hour:'2-digit',minute:'2-digit'}); }
document.addEventListener('DOMContentLoaded', function() {
  editModal = new bootstrap.Modal(document.getElementById('editProfileModal'));
  passwordModal = new bootstrap.Modal(document.getElementById('passwordModal'));
  function checkAuth() {
    if (window.AuthSystem && window.AuthSystem.isLoggedIn && window.AuthSystem.isLoggedIn()) { loadProfile(); hideLoading(); }
    else {
      var s = localStorage.getItem('upsen_current_user');
      if (s) { try { var d = JSON.parse(s); if (d && d.user) { loadProfileFromLocal(d.user); hideLoading(); return; } } catch (e) {} }
      setTimeout(checkAuth, 100);
    }
  }
  setTimeout(checkAuth, 200);
});
function loadProfileFromLocal(user) {
  var initials = (user.name || user.email || 'U').substring(0,2).toUpperCase();
  setText('userAvatar', initials);
  setText('userName', user.name || 'Usuario');
  setText('userEmail', user.email || '-');
  setText('userRole', user.role === 'admin' ? 'Administrador' : 'Usuario');
  setText('displayCompanyName', user.company || '-');
  setText('displayPhone', user.phone || '-');
  setText('displayEmail', user.email || '-');
  setText('displayRole', user.role === 'admin' ? 'Administrador' : 'Usuario');
  var curr = {'EUR':'Euro (EUR)','USD':'Dolar (USD)','GBP':'Libra (GBP)','BRL':'Real (BRL)'};
  var lang = {'es':'Espanol','pt':'Portugues','en':'English'};
  var them = {'light':'Claro','dark':'Oscuro'};
  var s = user.settings || {};
  setText('displayCurrency', curr[s.currency] || 'Euro (EUR)');
  setText('displayLanguage', lang[s.language] || 'Espanol');
  setText('displayTheme', them[s.theme] || 'Claro');
  setText('displayCreatedAt', formatDate(user.createdAt));
  setText('displayLastLogin', user.lastLogin ? formatDate(user.lastLogin) : 'Primera sesion');
  loadStats();
}
function loadStats() {
  var uid = getUserId();
  var inv = getUserData('upsen_invoices_received_' + uid);
  var iss = getUserData('upsen_invoices_issued_' + uid);
  var exp = getUserData('upsen_expenses_' + uid);
  var bud = getUserData('upsen_budgets_' + uid);
  setText('statInvoices', inv.length);
  setText('statIssued', iss.length);
  setText('statExpenses', exp.length);
  setText('statBudgets', bud.length);
}
function loadProfile() { var user = AuthSystem.getCurrentUser(); if (!user) return; loadProfileFromLocal(user); }
function showAlert(id, msg, type) { var el = document.getElementById(id); if (el) { el.textContent = msg; el.className = 'alert alert-' + (type || 'info'); el.classList.remove('hidden'); setTimeout(function() { el.classList.add('hidden'); }, 5000); } }
function showEditModal() { var user = AuthSystem.getCurrentUser(); if (!user) return; document.getElementById('editName').value = user.name || ''; document.getElementById('editCompany').value = user.company || ''; document.getElementById('editPhone').value = user.phone || ''; document.getElementById('editEmail').value = user.email || ''; var s = user.settings || {}; document.getElementById('editCurrency').value = s.currency || 'EUR'; document.getElementById('editLanguage').value = s.language || 'es'; document.getElementById('editTheme').value = s.theme || 'light'; document.getElementById('editAlert').classList.add('hidden'); editModal.show(); }
function showPasswordModal() { document.getElementById('newPassword').value = ''; document.getElementById('confirmPassword').value = ''; document.getElementById('passwordAlert').classList.add('hidden'); passwordModal.show(); }
async function saveProfile() {
  var name = document.getElementById('editName').value.trim();
  var company = document.getElementById('editCompany').value.trim();
  var phone = document.getElementById('editPhone').value.trim();
  var currency = document.getElementById('editCurrency').value;
  var language = document.getElementById('editLanguage').value;
  var theme = document.getElementById('editTheme').value;
  
  if (!name || !company) { showAlert('editAlert', 'Completa todos los campos.', 'error'); return; }
  
  var saveBtn = document.querySelector('#editProfileModal .btn-primary');
  if (saveBtn) { saveBtn.disabled = true; saveBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Guardando...'; }
  
  var res = await AuthSystem.updateUserProfile({name:name, company:company, phone:phone, settings:{currency:currency, language:language, theme:theme}});
  
  if (saveBtn) { saveBtn.disabled = false; saveBtn.innerHTML = '<i class="fas fa-save me-2"></i>Guardar'; }
  
  if (res.success) { 
    editModal.hide(); 
    loadProfile(); 
    showAlert('alertMessage', 'Perfil actualizado correctamente!', 'success');
    // Apply theme change
    applyTheme(theme);
  }
  else { showAlert('editAlert', res.message || 'Error.', 'error'); }
}

function applyTheme(theme) {
  if (theme === 'dark') {
    document.body.style.backgroundColor = '#1a1a2e';
    document.body.style.color = '#ffffff';
    var cards = document.querySelectorAll('.modern-card, .stat-card');
    cards.forEach(function(card) {
      card.style.backgroundColor = '#16213e';
      card.style.color = '#ffffff';
    });
    var titles = document.querySelectorAll('.section-title, .page-title, .info-label, .info-value, .stat-value, .stat-label');
    titles.forEach(function(t) {
      t.style.color = '#ffffff';
    });
  } else {
    document.body.style.backgroundColor = '#eef1f7';
    document.body.style.color = '#2c3e50';
    var cards = document.querySelectorAll('.modern-card, .stat-card');
    cards.forEach(function(card) {
      card.style.backgroundColor = 'white';
      card.style.color = '';
    });
  }
}
async function changePassword() {
  var np = document.getElementById('newPassword').value;
  var cp = document.getElementById('confirmPassword').value;
  if (!np || !cp) { showAlert('passwordAlert', 'Completa los campos.', 'error'); return; }
  if (np !== cp) { showAlert('passwordAlert', 'Las contrasenas no coinciden.', 'error'); return; }
  if (np.length < 6) { showAlert('passwordAlert', 'Minimo 6 caracteres.', 'error'); return; }
  var res = await AuthSystem.changePassword(np);
  if (res.success) { passwordModal.hide(); showAlert('alertMessage', 'Contrasena cambiada!', 'success'); }
  else { showAlert('passwordAlert', res.message || 'Error.', 'error'); }
}
function exportDataPDF() {
  var user = AuthSystem.getCurrentUser();
  if (!user) { showAlert('alertMessage', 'Usuario no encontrado.', 'error'); return; }
  var doc = new window.jspdf.jsPDF();
  doc.setFillColor(42, 77, 156);
  doc.rect(0, 0, 210, 35, 'F');
  doc.setTextColor(255, 255, 255);
  doc.setFontSize(20);
  doc.text('UPSEN Accounting', 105, 18, {align:'center'});
  doc.setFontSize(12);
  doc.text('Perfil de Usuario', 105, 28, {align:'center'});
  doc.setTextColor(100);
  doc.setFontSize(10);
  doc.text('Generado: ' + new Date().toLocaleDateString('es-ES'), 195, 45, {align:'right'});
  doc.line(15, 40, 195, 40);
  var y = 55;
  doc.setTextColor(0);
  doc.setFontSize(14);
  doc.text('Informacion del Perfil', 15, y);
  y += 10;
  doc.setFontSize(10);
  doc.text('Nombre: ' + (user.name || '-'), 20, y); y += 7;
  doc.text('Empresa: ' + (user.company || '-'), 20, y); y += 7;
  doc.text('Email: ' + (user.email || '-'), 20, y); y += 7;
  doc.text('Telefono: ' + (user.phone || '-'), 20, y); y += 15;
  doc.setFontSize(14);
  doc.text('Preferencias', 15, y);
  y += 10;
  doc.setFontSize(10);
  var s = user.settings || {};
  doc.text('Moneda: ' + (s.currency || 'EUR'), 20, y); y += 7;
  doc.text('Idioma: ' + (s.language || 'es'), 20, y); y += 7;
  doc.text('Tema: ' + (s.theme || 'light'), 20, y);
  doc.save('upsen_perfil.pdf');
  showAlert('alertMessage', 'PDF exportado!', 'success');
}
function deleteAccount() { if (confirm('Eliminar cuenta? Esta accion no se puede deshacer.')) { AuthSystem.deleteAccount(); window.location.href = '../login.html'; } }
function logout() { if (confirm('¿Cerrar sesión?')) { AuthSystem.logout(); window.location.href = '../login.html'; } }
</script>
</body>
</html>
